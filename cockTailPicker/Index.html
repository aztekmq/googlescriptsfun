<!DOCTYPE html>
<!--
  @fileoverview Front-end interface for the Cocktail Picker web application.
  Provides a form for collecting cocktail preferences and requests recommendations from the
  Google Apps Script backend which now uses the OpenAI API. Verbose client-side logging is
  included to assist with debugging across international development teams.
-->
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cocktail Picker</title>
    <style>
      :root {
        color-scheme: light dark;
        font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      }

      body {
        margin: 0;
        background: linear-gradient(135deg, #1e1e2f, #3d2c8d);
        color: #f1f1f1;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 32px;
      }

      .container {
        width: min(720px, 100%);
        background-color: rgba(24, 24, 34, 0.9);
        border-radius: 16px;
        padding: 32px;
        box-shadow: 0 20px 45px rgba(0, 0, 0, 0.35);
        backdrop-filter: blur(14px);
      }

      h1 {
        font-size: 2.25rem;
        margin-bottom: 12px;
        font-weight: 700;
      }

      p.description {
        margin-bottom: 24px;
        line-height: 1.6;
      }

      form {
        display: grid;
        gap: 20px;
      }

      label {
        display: block;
        font-weight: 600;
        margin-bottom: 8px;
      }

      input,
      textarea,
      select {
        width: 100%;
        padding: 12px;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        background-color: rgba(10, 10, 20, 0.6);
        color: inherit;
        font-size: 1rem;
        transition: border 0.2s ease, box-shadow 0.2s ease;
      }

      input:focus,
      textarea:focus,
      select:focus {
        outline: none;
        border-color: #ff9d2f;
        box-shadow: 0 0 0 3px rgba(255, 157, 47, 0.3);
      }

      button {
        cursor: pointer;
        padding: 14px 22px;
        border-radius: 999px;
        border: none;
        font-weight: 600;
        font-size: 1rem;
        background: linear-gradient(135deg, #ff9d2f, #ff3f81);
        color: #14141f;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }

      button:hover {
        transform: translateY(-1px);
        box-shadow: 0 10px 20px rgba(255, 63, 129, 0.35);
      }

      .result {
        margin-top: 32px;
        padding: 24px;
        border-radius: 12px;
        background-color: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.08);
        line-height: 1.7;
        display: none;
      }

      .result.active {
        display: block;
      }

      .result h2 {
        margin-top: 0;
        font-size: 1.8rem;
      }

      ul.ingredients {
        padding-left: 24px;
        margin-top: 10px;
      }

      .error {
        color: #ff9d2f;
        margin-top: 16px;
        display: none;
      }

      .error.active {
        display: block;
      }
    </style>
  </head>
  <body>
    <main class="container">
      <header>
        <h1>Cocktail Picker</h1>
        <p class="description">
          Provide a few details about your desired cocktail and we will consult OpenAI's mixology
          expertise for a personalised recipe.
        </p>
      </header>

      <form id="cocktail-form" autocomplete="off">
        <div class="field">
          <label for="baseSpirit">Preferred base spirit</label>
          <select id="baseSpirit" name="baseSpirit" required>
            <option value="">Select a spirit</option>
            <option value="vodka">Vodka</option>
            <option value="gin">Gin</option>
            <option value="rum">Rum</option>
            <option value="tequila">Tequila</option>
            <option value="whisky">Whisky</option>
            <option value="brandy">Brandy</option>
            <option value="mezcal">Mezcal</option>
            <option value="non-alcoholic">Non-alcoholic</option>
          </select>
        </div>

        <div class="field">
          <label for="flavorProfile">Flavour profile</label>
          <input
            id="flavorProfile"
            name="flavorProfile"
            placeholder="e.g., refreshing, citrus-forward, herbaceous"
            required
          />
        </div>

        <div class="field">
          <label for="additionalNotes">Additional guidance</label>
          <textarea
            id="additionalNotes"
            name="additionalNotes"
            rows="3"
            placeholder="Occasion, desired difficulty, equipment limits, or dietary needs"
          ></textarea>
        </div>

        <button type="submit">Request Recommendation</button>
      </form>

      <section id="error" class="error" role="alert"></section>

      <section id="result" class="result" aria-live="polite"></section>
    </main>

    <script>
      /**
       * @fileoverview Handles client-side form submission and renders responses from the Apps Script backend.
       */
      (function () {
        const form = document.getElementById('cocktail-form');
        const resultContainer = document.getElementById('result');
        const errorContainer = document.getElementById('error');

        /**
         * Displays the cocktail recommendation in a human-friendly format.
         * @param {{name: string, description: string, ingredients: string[], preparation: string, garnish: string}} suggestion
         */
        function renderSuggestion(suggestion) {
          console.info('[CocktailPicker] Rendering suggestion', suggestion);
          const ingredientItems = suggestion.ingredients
            .map((ingredient) => `<li>${ingredient}</li>`)
            .join('');

          resultContainer.innerHTML = `
            <h2>${suggestion.name}</h2>
            <p>${suggestion.description}</p>
            <h3>Ingredients</h3>
            <ul class="ingredients">${ingredientItems}</ul>
            <h3>Preparation</h3>
            <p>${suggestion.preparation}</p>
            <h3>Suggested garnish</h3>
            <p>${suggestion.garnish}</p>
          `;
          resultContainer.classList.add('active');
        }

        /**
         * Reports errors to the user while keeping the console log verbose for debugging.
         * @param {string} message
         */
        function reportError(message) {
          console.error('[CocktailPicker] Error encountered', message);
          errorContainer.textContent = message;
          errorContainer.classList.add('active');
        }

        form.addEventListener('submit', (event) => {
          event.preventDefault();
          console.debug('[CocktailPicker] Form submission intercepted. Preparing payload.');

          resultContainer.classList.remove('active');
          errorContainer.classList.remove('active');

          const formData = {
            baseSpirit: form.baseSpirit.value,
            flavorProfile: form.flavorProfile.value,
            additionalNotes: form.additionalNotes.value,
          };

          console.debug('[CocktailPicker] Dispatching preferences to server.', formData);
          google.script.run
            .withSuccessHandler((suggestion) => {
              console.debug('[CocktailPicker] Suggestion received from server.', suggestion);
              renderSuggestion(suggestion);
            })
            .withFailureHandler((error) => {
              console.error('[CocktailPicker] Server returned an error.', error);
              reportError(
                'We were unable to retrieve a cocktail suggestion. Please review the logs or try again shortly.'
              );
            })
            .getCocktailSuggestion(formData);
        });
      })();
    </script>
  </body>
</html>
